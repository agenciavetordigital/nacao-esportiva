<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Nação Esportiva</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .category-btn.active {
      background-color: #1A2E4E;
      color: white;
    }
    .delete-btn {
      position: absolute;
      top: 10px;
      right: 10px;
      background: red;
      color: white;
      border-radius: 50%;
      padding: 4px 8px;
      cursor: pointer;
    }
  </style>
</head>
<body class="bg-gray-100 font-sans">

  <!-- Filtros de categoria -->
  <div id="category-filters" class="flex justify-center gap-4 p-4">
    <button class="category-btn active" data-category="Mais Vendidos">Mais Vendidos</button>
    <button class="category-btn" data-category="Academia">Academia</button>
  </div>

  <!-- Grade de produtos -->
  <div id="product-grid" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6 p-6"></div>

  <!-- Painel admin -->
  <div id="admin-panel" class="p-6 bg-white rounded-lg shadow-lg max-w-lg mx-auto mt-6 hidden">
    <h2 class="text-xl font-bold mb-4">Adicionar Produto</h2>
    <input id="product-name" class="w-full p-2 border mb-2" placeholder="Nome do produto">
    <input id="product-link" class="w-full p-2 border mb-2" placeholder="Link do produto">
    <input id="product-image" class="w-full p-2 border mb-2" placeholder="URL da imagem">
    <div id="product-category-checkboxes" class="flex gap-4 mb-2">
      <label><input type="checkbox" value="Mais Vendidos"> Mais Vendidos</label>
      <label><input type="checkbox" value="Academia"> Academia</label>
    </div>
    <button id="add-product-btn" class="bg-green-600 text-white px-4 py-2 rounded">Adicionar</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import { getFirestore, collection, onSnapshot, addDoc, deleteDoc, doc, getDocs, writeBatch } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
    import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    document.addEventListener('DOMContentLoaded', () => {
      // Config do Firebase
      const firebaseConfig = {
        apiKey: "AIzaSyDuhM2qqaj68Ve8G_eMcEU-9dmZLFBzh4U",
        authDomain: "nacao-esportiva-7f224.firebaseapp.com",
        projectId: "nacao-esportiva-7f224",
        storageBucket: "nacao-esportiva-7f224.firebasestorage.app",
        messagingSenderId: "55149738514",
        appId: "1:55149738514:web:d8abff9e41309242dd36cb",
        measurementId: "G-18PEDQ3W5H"
      };

      const ADMIN_PASSWORD = "nacaoesportiva2025";
      let adminMode = false;
      let allProducts = [];

      const initialProducts = [
        {"name":"Elástico Extensor de Exercícios - FORIOUS","link":"https://s.shopee.com.br/3fuDBzjYkT","image":"https://down-br.img.susercontent.com/file/br-11134207-7r98o-lq0tijs0y9ev1a.webp","category":["Academia"]},
        {"name":"Conjunto feminino Blusão + bermuda - Nandamatos","link":"https://s.shopee.com.br/20lzD0jYOF","image":"https://down-br.img.susercontent.com/file/br-11134207-7r98o-lxfi56smq5z311.webp","category":["Mais Vendidos","Academia"]},
        {"name":"Óculos De Natação Infantil - Choice Oficial","link":"https://s.shopee.com.br/1LWIPvZelv","image":"https://down-br.img.susercontent.com/file/sg-11134201-824h7-mei1y3w70kqqb8.webp","category":["Mais Vendidos"]},
        {"name":"kit 3 Faixas Elástica de Resistência - Tudodo","link":"https://s.shopee.com.br/8fIt9SWrDB","image":"https://down-br.img.susercontent.com/file/sg-11134201-7rdyu-mc67bqz0h71o16.webp","category":["Mais Vendidos","Academia"]},
        {"name":"Colchonete p/ Academia Premium - La Casa Home","link":"https://s.shopee.com.br/2LOpbuWXrZ","image":"https://down-br.img.susercontent.com/file/br-11134207-7r98o-lzjhnmdxayw586.webp","category":["Academia","Mais Vendidos"]}
      ];

      // Inicializar Firebase
      const app = initializeApp(firebaseConfig);
      const db = getFirestore(app);
      const auth = getAuth(app);
      signInAnonymously(auth).catch(console.error);

      const productsCollection = collection(db, "products");

      // Renderizar produtos
      const renderProducts = (filter) => {
        const productGrid = document.getElementById('product-grid');
        const currentFilter = filter || document.querySelector('.category-btn.active')?.dataset.category || 'Mais Vendidos';
        productGrid.innerHTML = '';
        const filtered = allProducts.filter(p => p.category.includes(currentFilter));

        if (filtered.length === 0) {
          productGrid.innerHTML = `<p class="col-span-full text-center text-gray-500">Nenhum produto nesta categoria.</p>`;
        } else {
          filtered.forEach(p => {
            const card = document.createElement('div');
            card.className = 'product-card bg-white rounded-lg shadow-lg overflow-hidden relative';
            card.innerHTML = `
              <a href="${p.link}" target="_blank" rel="noopener sponsored">
                <img src="${p.image}" alt="${p.name}" class="w-full h-56 object-cover">
                <div class="p-6">
                  <h3 class="font-bold text-xl text-[#1A2E4E]">${p.name}</h3>
                </div>
              </a>
              ${adminMode ? `<div class="delete-btn" data-id="${p.id}">X</div>` : ''}
            `;
            productGrid.appendChild(card);
          });
        }
      };

      // Adicionar produto
      const addProduct = async () => {
        const name = document.getElementById('product-name').value.trim();
        const link = document.getElementById('product-link').value.trim();
        const image = document.getElementById('product-image').value.trim();
        const categories = Array.from(document.querySelectorAll('#product-category-checkboxes input:checked')).map(cb => cb.value);

        if (!name || !link || !image || categories.length === 0) return alert('Preencha todos os campos.');
        await addDoc(productsCollection, { name, link, image, category: categories });
      };

      // Deletar produto
      const deleteProduct = async (id) => {
        await deleteDoc(doc(db, "products", id));
      };

      // População inicial se o banco estiver vazio
      (async () => {
        const snapshot = await getDocs(productsCollection);
        if (snapshot.empty) {
          const batch = writeBatch(db);
          initialProducts.forEach(p => batch.set(doc(productsCollection), p));
          await batch.commit();
        }
      })();

      // Listener em tempo real
      onSnapshot(productsCollection, (snapshot) => {
        allProducts = snapshot.docs.map(docSnap => ({ id: docSnap.id, ...docSnap.data() }));
        renderProducts();
      });

      // Eventos
      document.getElementById('add-product-btn').addEventListener('click', addProduct);
      document.getElementById('product-grid').addEventListener('click', (e) => {
        if (e.target.classList.contains('delete-btn')) {
          deleteProduct(e.target.dataset.id);
        }
      });
      document.getElementById('category-filters').addEventListener('click', (e) => {
        if (e.target.tagName === 'BUTTON') {
          document.querySelector('.category-btn.active')?.classList.remove('active');
          e.target.classList.add('active');
          renderProducts(e.target.dataset.category);
        }
      });

      // Ativar painel admin
      document.addEventListener('keydown', (e) => {
        if (e.ctrlKey && e.key === 'a') {
          const senha = prompt("Digite a senha de administrador:");
          if (senha === ADMIN_PASSWORD) {
            adminMode = true;
            document.getElementById('admin-panel').classList.remove('hidden');
            renderProducts();
          }
        }
      });
    });
  </script>
</body>
</html>
